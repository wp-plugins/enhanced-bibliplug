(function(a){refreshOrder=function(){var b=a("table#bibliplug-creators tbody").sortable("toArray");for(i=0;i<b.length;i++){a("table#bibliplug-creators tbody").children("tr#"+b[i]).find("input.order-index").val(i)}};deleteCreator=function(b){if(b.closest("tbody").children().length>1){b.closest("tr").remove();refreshOrder();a("table#bibliplug-creators tbody").children().each(function(){a(this).attr("id","creator-row-"+a(this).find("input.order-index").val())})}};refreshDetails=function(){var b={bib_id:a("#hiddenbibid").val(),new_type_id:a("#bibliplug_ref_type").val()};a.post(ajaxurl+"?action=bibliplug_change_ref_type",b,function(c){a("#bibliplug_details_meta_box").empty().append(c);a("select#bibliplug_ref_type").change(refreshDetails)})};a(document).ready(function(b){postboxes.add_postbox_toggles("bibliplug_form");b(".input-with-hint").focus(function(){b(this).next("span").css("background-color","#FFFF33")}).blur(function(){b(this).next("span").css("background-color","")});b("select#bibliplug_ref_type").change(refreshDetails);b("input#add-creator").click(function(){var d=Math.floor(Math.random()*1000);var c=b(this).closest("#bibliplug_creators_meta_box").find("table#bibliplug-creators");var f=c.find("tr").last().clone();var g=c.children("tbody").children().length;var e=parseInt(f.find("input.order-index").val())+1;f.find("input").each(function(){b(this).attr("name",b(this).attr("name").replace(/\[-?[0-9]+\]/,"[-"+d+"]")).val("")});f.find("select").attr("name","creator[-"+d+"][creator_type_id]").val("");f.attr("id","creator-row-"+g);f.find("input.order-index").val(e);f.find(".delete-creator").click(function(){deleteCreator(b(this))});c.append(f)});b(".delete-creator").click(deleteCreator(b(this)));b("table#bibliplug-creators tbody").sortable({placeholder:"bibliplug-state-highlight",stop:function(c,d){refreshOrder()}})})})(jQuery);